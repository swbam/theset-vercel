create or replace function increment_vote(song_id uuid, user_id uuid) returns void as $$ begin insert into votes (song_id, user_id, count) values (song_id, user_id, 1) on conflict (song_id, user_id) do update set count = votes.count + 1; update setlist_songs set vote_count = vote_count + 1 where id = song_id; end; $$ language plpgsql; create or replace function decrement_vote(song_id uuid, user_id uuid) returns void as $$ begin update votes set count = greatest(count - 1, 0) where song_id = song_id and user_id = user_id; update setlist_songs set vote_count = greatest(vote_count - 1, 0) where id = song_id; end; $$ language plpgsql;
